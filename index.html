<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>GPA Calculator</title>
  <style>
    :root{
      --bg:#f7f7f8; --card:#ffffff; --text:#111827; --muted:#6b7280; --accent:#2563eb;
    }
    [data-theme="dark"]{ --bg:#121212; --card:#1f2937; --text:#e6eef8; --muted:#94a3b8; --accent:#60a5fa }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; background:var(--bg); color:var(--text); padding:24px}
    .container{max-width:900px; margin:0 auto}
    .card{background:var(--card); border-radius:12px; padding:18px; box-shadow:0 6px 20px rgba(10,20,40,0.06)}
    h1{margin:0 0 8px; font-size:20px}
    .controls{display:flex; gap:8px; flex-wrap:wrap; margin-bottom:12px}
    button{background:var(--accent); color:white; border:0; padding:8px 12px; border-radius:8px; cursor:pointer}
    button.ghost{background:transparent; color:var(--text); border:1px solid rgba(0,0,0,0.06)}
    .table{width:100%; border-collapse:collapse; margin-bottom:12px}
    .table thead th{ text-align:left; font-size:13px; color:var(--muted); padding:8px}
    .table tbody td{padding:8px; vertical-align:middle}
    input[type=text], select, input[type=number]{padding:6px 8px; border-radius:6px; border:1px solid #d1d5db; width:100%; font-size:14px;background:transparent; color:var(--text)}
    .row-actions button{background:#ef4444}
    .gpa{font-weight:700; font-size:18px; margin-top:6px}
    .small{font-size:13px; color:var(--muted)}
    .flex{display:flex; gap:8px; align-items:center}
    .right{margin-left:auto}
    @media (max-width:640px){ .controls{flex-direction:column} }
  </style>
</head>
<body>
  <div class="container">
    <div class="card" id="app">
      <h1>GPA Calculator</h1>
      <div class="small">Add courses, choose letter grades and credits â€” GPA updates automatically.</div>

      <div class="controls" style="margin-top:12px">
        <button id="addCourse">+ Add Course</button>
        <button id="saveLocal" class="ghost">Save to browser</button>
        <button id="loadLocal" class="ghost">Load from browser</button>
        <button id="exportJson" class="ghost">Export JSON</button>
        <button id="importJson" class="ghost">Import JSON</button>
        <button id="toggleTheme" style="margin-left:auto">Toggle Dark</button>
        <input type="file" id="fileInput" accept="application/json" style="display:none" />
      </div>

      <table class="table" id="coursesTable">
        <thead>
          <tr>
            <th style="width:45%">Course</th>
            <th style="width:20%">Grade</th>
            <th style="width:15%">Credits</th>
            <th style="width:10%">Action</th>
          </tr>
        </thead>
        <tbody id="tbody"></tbody>
      </table>

      <div class="flex">
        <div class="gpa">Your GPA: <span id="gpaValue">0.00</span></div>
        <div class="right small">Total Credits: <span id="totalCredits">0</span></div>
      </div>

      <div style="margin-top:12px" class="small">Notes: Saves use your browser localStorage. Export creates a JSON file you can re-import.</div>
    </div>
  </div>

  <script>
    // grade to points mapping (matches the original python mapping)
    const gradePoints = {"A":4.0,"A-":3.7,"B+":3.3,"B":3.0,"B-":2.7,"C+":2.3,"C":2.0,"C-":1.7,"D+":1.3,"D":1.1,"D-":1.0,"F":0.0};

    const tbody = document.getElementById('tbody');
    const gpaValue = document.getElementById('gpaValue');
    const totalCreditsEl = document.getElementById('totalCredits');
    const addCourseBtn = document.getElementById('addCourse');
    const saveLocalBtn = document.getElementById('saveLocal');
    const loadLocalBtn = document.getElementById('loadLocal');
    const exportJsonBtn = document.getElementById('exportJson');
    const importJsonBtn = document.getElementById('importJson');
    const fileInput = document.getElementById('fileInput');
    const toggleThemeBtn = document.getElementById('toggleTheme');

    function createRow(course='', grade='A', credits=''){
      const tr = document.createElement('tr');

      const tdCourse = document.createElement('td');
      const courseInput = document.createElement('input');
      courseInput.type = 'text'; courseInput.value = course; courseInput.placeholder = 'e.g. Calculus';
      tdCourse.appendChild(courseInput);

      const tdGrade = document.createElement('td');
      const gradeSelect = document.createElement('select');
      Object.keys(gradePoints).forEach(g => { const o=document.createElement('option'); o.value=g; o.textContent=g; gradeSelect.appendChild(o); });
      gradeSelect.value = grade || 'A';
      tdGrade.appendChild(gradeSelect);

      const tdCredits = document.createElement('td');
      const creditsInput = document.createElement('input'); creditsInput.type='number'; creditsInput.step='0.25'; creditsInput.min='0'; creditsInput.value = credits;
      creditsInput.placeholder='0'; tdCredits.appendChild(creditsInput);

      const tdAction = document.createElement('td'); tdAction.className = 'row-actions';
      const del = document.createElement('button'); del.textContent='X'; del.title='Remove'; del.onclick = () => { tr.remove(); calculateGpa(); };
      tdAction.appendChild(del);

      tr.appendChild(tdCourse); tr.appendChild(tdGrade); tr.appendChild(tdCredits); tr.appendChild(tdAction);

      // live updates
      [gradeSelect, creditsInput].forEach(el => el.addEventListener('input', calculateGpa));

      tbody.appendChild(tr);
      calculateGpa();
      return tr;
    }

    function calculateGpa(){
      let totalCredits = 0; let totalPoints = 0;
      Array.from(tbody.querySelectorAll('tr')).forEach(row => {
        const grade = row.cells[1].querySelector('select').value;
        const creditsRaw = row.cells[2].querySelector('input').value;
        const credits = parseFloat(creditsRaw) || 0;
        totalCredits += credits;
        const gp = gradePoints[grade] ?? 0;
        totalPoints += gp * credits;
      });
      const gpa = totalCredits === 0 ? 0 : (totalPoints / totalCredits);
      gpaValue.textContent = gpa.toFixed(2);
      totalCreditsEl.textContent = totalCredits.toFixed(2);
    }

    // persistence using localStorage
    function saveToLocal(){
      const data = Array.from(tbody.querySelectorAll('tr')).map(row => ({
        course: row.cells[0].querySelector('input').value,
        grade: row.cells[1].querySelector('select').value,
        credits: row.cells[2].querySelector('input').value
      }));
      localStorage.setItem('gpa_data_v1', JSON.stringify(data));
      alert('Saved to browser (localStorage).');
    }

    function loadFromLocal(){
      const raw = localStorage.getItem('gpa_data_v1');
      if(!raw){ alert('No saved data in browser.'); return; }
      const data = JSON.parse(raw);
      tbody.innerHTML='';
      data.forEach(d => createRow(d.course,d.grade,d.credits));
      calculateGpa();
    }

    // export / import JSON
    function exportJson(){
      const data = Array.from(tbody.querySelectorAll('tr')).map(row => ({
        course: row.cells[0].querySelector('input').value,
        grade: row.cells[1].querySelector('select').value,
        credits: row.cells[2].querySelector('input').value
      }));
      const blob = new Blob([JSON.stringify(data, null, 2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='gpa_data.json'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
    }

    importJsonBtn.addEventListener('click', ()=> fileInput.click());
    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(reader.result);
          tbody.innerHTML='';
          data.forEach(d => createRow(d.course,d.grade,d.credits));
          calculateGpa();
          alert('Imported successfully.');
        }catch(err){ alert('Invalid JSON file.'); }
      };
      reader.readAsText(f);
      fileInput.value='';
    });

    // theme toggle
    function toggleTheme(){
      const root = document.documentElement; const current = root.getAttribute('data-theme');
      if(current === 'dark'){ root.removeAttribute('data-theme'); localStorage.removeItem('gpa_theme'); }
      else{ root.setAttribute('data-theme','dark'); localStorage.setItem('gpa_theme','dark'); }
    }

    // restore theme
    if(localStorage.getItem('gpa_theme') === 'dark') document.documentElement.setAttribute('data-theme','dark');

    // wire buttons
    addCourseBtn.addEventListener('click', ()=> createRow());
    saveLocalBtn.addEventListener('click', saveToLocal);
    loadLocalBtn.addEventListener('click', loadFromLocal);
    exportJsonBtn.addEventListener('click', exportJson);
    toggleThemeBtn.addEventListener('click', toggleTheme);

    // start with one row if empty
    if(tbody.children.length === 0) createRow();
  </script>
</body>
</html>
